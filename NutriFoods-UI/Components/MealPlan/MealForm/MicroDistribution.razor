@using Fluxor
@using NutriFoods_UI.Data.Dto
@using NutriFoods_UI.Data.Store.MicronutrientConfiguration
@inject IState<MicronutrientState> MicroState
@inject IDispatcher Dispatcher
@inherits Fluxor.Blazor.Web.Components.FluxorComponent

@page "/micro"


<MudGrid Class="px-3">
    <MudItem xs="4" Class="d-flex flex-column gap-2">
        <span>Límite de consumo</span>
        <p>Lorem ipsum dolor sit amet</p>
    </MudItem>
    <MudItem xs="8">
        <MudStack>
            @if (MicroState.Value.Initialized)
            {
                for (var i = 0; i < MicroState.Value.Micronutrients.Count(); i++)
                {
                    <div class="d-flex flex-column">
                        <MicroNutrientIntake Index="i"></MicroNutrientIntake>
                    </div>
                }
            }
            <div class="ml-6">
                <MudButton Size="Size.Small" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" Variant="Variant.Outlined"
                           OnClick="AddNewMicroNutrient" Style="width: 250px">
                    Añadir Macronutriente
                </MudButton>
            </div>

        </MudStack>
    </MudItem>
</MudGrid>


@code {


    protected override Task OnInitializedAsync()
    {
        if (MicroState.Value.Initialized != false) return base.OnInitializedAsync();
        Dispatcher.Dispatch(new InitializeMicronutrientAction());
        return base.OnInitializedAsync();
    }

    private void AddNewMicroNutrient()
    {
        Dispatcher.Dispatch(new AddMicronutrientAction(new MicroNutrientDto()));
    }

}